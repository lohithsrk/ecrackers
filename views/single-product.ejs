<%-include('partials/header.ejs')%>
<section class="mainnn">
            <!-- Header Area End Here -->
            <!-- Begin Li's Breadcrumb Area -->
            <span class="msg" data-msg="<%= user===null?'Login to Continue!':'' %>"></span>
            <div class="frame1 hide">
              <div class="loginModal">
                <p class="text-center my-5 mx-auto">Login To Continue</p>
                <div class="button redirectHome">  LOGIN  </div>
              </div>
            </div>
            <div class="frame2 hide">
              <div class="CartModal">
                <p class="text-center my-5 mx-auto">Added to Cart Successfully</p>
                <div class="button addCart">  CLOSE  </div>
              </div>
            </div>
            <div class="frame3 hide">
              <div class="WishlistModal">
                <p class="text-center my-5 mx-auto">Added to wishlist Successfully</p>
                <div class="button addWishlist">  CLOSE  </div>
              </div>
            </div>
            <div class="breadcrumb-area">
                <div class="container">
                    <div class="breadcrumb-content">
                        <ul>
                            <li><a href="/">Home</a></li>
                            <li class="active">Single Product</li>
                        </ul>
                    </div>
                </div>
            </div>
            <!-- Li's Breadcrumb Area End Here -->
            <!-- content-wraper start -->
            <div class="content-wraper">
                <div class="container">
                    <div class="row single-product-area">
                        <div class="col-lg-5 col-md-6">
                           <!-- Product Details Left -->
                            <div class="product-details-left">
                                <div class="product-details-images slider-navigation-1">
                                    <div class="lg-image">
                                        <a class="popup-img venobox vbox-item" href="<%= product[0].image %>" data-gall="myGallery">
                                            <img class="pt-4" src="<%= product[0].image %>" alt="product image">
                                        </a>
                                    </div>
                                </div>
                            </div>
                            <!--// Product Details Left -->
                        </div>

                        <div class="col-lg-7 col-md-6">
                            <div class="product-details-view-content pt-60">
                                <div class="product-info">
                                    <h2 class="product-name"><%= product[0].name %></h2>
                                    <span class="product-details-ref"><%= product[0].desc %></span>
                                    <div class="rating-box pt-20">
                                        <ul class="rating rating-with-review-item">
                                            <% if (product[0].rating) { %>
                                                <% for( let index = 0; index < product[0].rating ; index++ ) { %>
                                                    <li><i class="fa fa-star-o"></i></li>
                                                <% } %>
                                            <% } %>
                                            <% if (product[0].negrating) { %>
                                                <% for( let index = 0; index < product[0].negrating ; index++ ) { %>
                                                    <li class="no-star"><i class="fa fa-star-o"></i></li>
                                                <% } %>
                                            <% } %>
                                        </ul>
                                    </div>
                                    <div class="price-box pt-20">
                                       <span class="new-price product-price new-price-2"><%= product[0].discount %></span>
                                       <span class="old-price strikeThrough"><%= product[0].price %></span>
                                       <!-- <span class="discount-percentage">-7%</span> -->
                                   </div>
                                    <div class="product-desc">

                                      </div>
                                        <p>
                                            <!-- <span class="pro-desc"><%= product[0].desc %></span> -->
                                            <p class="lowerText"><span><%= product[0].description %></span></p>
                                        </p>
                                    </div>
                                    <div class="single-add-to-cart">
                                        <form action="#" class="cart-quantity">
                                            <div class="quantity">
                                                <!-- <label>Quantity</label> -->
                                                <div class="cart-plus-minus">
                                                    <!-- <input class="cart-plus-minus-box" value="1" type="text"> -->
                                                    <!-- <div class="dec qtybutton"><i class="fa fa-angle-down"></i></div>
                                                    <div class="inc qtybutton"><i class="fa fa-angle-up"></i></div> -->
                                                </div>
                                            </div>
                                            <button class="add-to-cart" data-uid="<%= user._id %>" onclick="cartUpdate('<%= product[0].id %>', '<%= user._id %>')" class="add-to-cart-link">Add to cart</button>
                                        </form>
                                    </div>
                                    <div class="product-additional-info pt-25">
                                        <li onclick="wish('<%= product[0].id %>','<%=user===null?null: user._id %>')"><a class="links-details add-to-wishlist-link wishlist-btn" href="#" data-uid="<%=user===null?null: user._id.toLocaleString()%>" class="" id="<%= product[0].id %>"><i class="fa fa-heart-o"></i>Add to wishlist</a></li>
                                    </div>
                                    <div class="block-reassurance">
                                        <ul>
                                            <li>
                                                <div class="reassurance-item">
                                                    <div class="reassurance-icon">
                                                        <i class="fa fa-check-square-o"></i>
                                                    </div>
                                                    <p>Security policy (edit with Customer reassurance module)</p>
                                                </div>
                                            </li>
                                            <li>
                                                <div class="reassurance-item">
                                                    <div class="reassurance-icon">
                                                        <i class="fa fa-truck"></i>
                                                    </div>
                                                    <p>Delivery policy (edit with Customer reassurance module)</p>
                                                </div>
                                            </li>
                                            <li>
                                                <div class="reassurance-item">
                                                    <div class="reassurance-icon">
                                                        <i class="fa fa-exchange"></i>
                                                    </div>
                                                    <p> Return policy (edit with Customer reassurance module)</p>
                                                </div>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- content-wraper end -->
            <!-- Begin Product Area -->
            <div class="product-area pt-35">
                <div class="container">
                    <div class="row">
                        <div class="col-lg-12">
                            <div class="li-product-tab">
                                <ul class="nav li-product-menu">
                                   <!-- <li><a class="active" data-toggle="tab" href="#description"><span>Description</span></a></li>
                                   <li><a data-toggle="tab" href="#product-details"><span>Product Details</span></a></li> -->
                                   <li><a data-toggle="tab" href="#reviews"><span>Reviews</span></a></li>
                                </ul>
                            </div>
                            <!-- Begin Li's Tab Menu Content Area -->
                        </div>
                    </div>
                    <div class="tab-content">
                        <div id="reviews" class="tab-pane" role="tabpanel">
                            <div class="product-reviews">
                                <div class="product-details-comment-block">
                                    <div class="review-btn">
                                        <a class="review-links" href="#" data-toggle="modal" data-target="#mymodal">Write Your Review!</a>
                                    </div>
                                    <!-- Begin Quick View | Modal Area -->
                                    <div class="modal fade modal-wrapper" id="mymodal" >
                                        <div class="modal-dialog modal-dialog-centered" role="document">
                                            <div class="modal-content">
                                                <div class="modal-body">
                                                    <h3 class="review-page-title">Write Your Review</h3>
                                                    <div class="modal-inner-area row">
                                                        <div class="col-lg-6">
                                                           <div class="li-review-product">
                                                               <img src="<%= product[0].image %>" alt="Li's Product">
                                                               <div class="li-review-product-desc">
                                                                   <p class="li-product-name "><%= product[0].name %></p>
                                                                   <p class="lowerText">
                                                                       <span><%= product[0].desc %></span>
                                                                       <p class="lowerText"><span><%= product[0].description %></span></p>
                                                                   </p>
                                                               </div>
                                                           </div>
                                                        </div>
                                                        <div class="col-lg-6">
                                                            <div class="li-review-content">
                                                                <!-- Begin Feedback Area -->
                                                                <div class="feedback-area">
                                                                    <div class="feedback">
                                                                        <h3 class="feedback-title">Our Feedback</h3>
                                                                        <form action="#">
                                                                            <p class="your-opinion">
                                                                                <label>Your Rating</label>
                                                                                <span>
                                                                                    <select class="star-rating">
                                                                                      <option value="1">1</option>
                                                                                      <option value="2">2</option>
                                                                                      <option value="3">3</option>
                                                                                      <option value="4">4</option>
                                                                                      <option value="5">5</option>
                                                                                    </select>
                                                                                </span>
                                                                            </p>
                                                                            <p class="feedback-form">
                                                                                <label for="feedback">Your Review</label>
                                                                                <textarea id="feedback" name="comment" cols="45" rows="8" aria-required="true"></textarea>
                                                                            </p>
                                                                            <div class="feedback-input">
                                                                                <p class="feedback-form-author">
                                                                                    <label for="author">Name<span class="required">*</span>
                                                                                    </label>
                                                                                    <input id="author" name="author" value="" size="30" aria-required="true" type="text">
                                                                                </p>
                                                                                <p class="feedback-form-author feedback-form-email">
                                                                                    <label for="email">Email<span class="required">*</span>
                                                                                    </label>
                                                                                    <input id="email" name="email" value="" size="30" aria-required="true" type="text">
                                                                                    <span class="required"><sub>*</sub> Required fields</span>
                                                                                </p>
                                                                                <div class="feedback-btn pb-15">
                                                                                    <a href="#" class="close" data-dismiss="modal" aria-label="Close">Close</a>
                                                                                    <a href="#">Submit</a>
                                                                                </div>
                                                                            </div>
                                                                        </form>
                                                                    </div>
                                                                </div>
                                                                <!-- Feedback Area End Here -->
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- Quick View | Modal Area End Here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Product Area End Here -->
            <!-- Begin Quick View | Modal Area -->
            <div class="modal fade modal-wrapper" id="exampleModalCenter" >
                <div class="modal-dialog modal-dialog-centered" role="document">
                    <div class="modal-content">
                        <div class="modal-body">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                            <div class="modal-inner-area row">
                                <div class="col-lg-5 col-md-6 col-sm-6">
                                   <!-- Product Details Left -->
                                    <div class="product-details-left">
                                        <div class="product-details-images slider-navigation-1">
                                            <div class="lg-image">
                                                <img src="/images/product/large-size/p1.jpg" alt="product image">
                                            </div>
                                            <div class="lg-image">
                                                <img src="/images/product/large-size/p2.jpg" alt="product image">
                                            </div>
                                            <div class="lg-image">
                                                <img src="/images/product/large-size/p7.jpg" alt="product image">
                                            </div>
                                            <div class="lg-image">
                                                <img src="/images/product/large-size/p8.jpg" alt="product image">
                                            </div>
                                            <div class="lg-image">
                                                <img src="/images/product/large-size/p9.jpg" alt="product image">
                                            </div>
                                            <div class="lg-image">
                                                <img src="/images/product/large-size/p10.jpg" alt="product image">
                                            </div>
                                        </div>
                                        <div class="product-details-thumbs slider-thumbs-1">
                                            <div class="sm-image"><img src="/images/product/small-size/p12.jpg" alt="product image thumb"></div>
                                            <div class="sm-image"><img src="/images/product/small-size/p13.jpg" alt="product image thumb"></div>
                                            <div class="sm-image"><img src="/images/product/small-size/p14.jpg" alt="product image thumb"></div>
                                            <div class="sm-image"><img src="/images/product/small-size/p15.jpg" alt="product image thumb"></div>
                                            <div class="sm-image"><img src="/images/product/small-size/p16.jpg" alt="product image thumb"></div>
                                            <div class="sm-image"><img src="/images/product/small-size/p17.jpg" alt="product image thumb"></div>
                                        </div>
                                    </div>
                                    <!--// Product Details Left -->
                                </div>

                                <div class="col-lg-7 col-md-6 col-sm-6">
                                    <div class="product-details-view-content pt-60">
                                        <div class="product-info">
                                            <h2>Dummy Single Product Text</h2>
                                            <span class="product-details-ref">Reference: demo_15</span>
                                            <div class="rating-box pt-20">
                                                <ul class="rating rating-with-review-item">
                                                    <li><i class="fa fa-star-o"></i></li>
                                                    <li><i class="fa fa-star-o"></i></li>
                                                    <li><i class="fa fa-star-o"></i></li>
                                                    <li class="no-star"><i class="fa fa-star-o"></i></li>
                                                    <li class="no-star"><i class="fa fa-star-o"></i></li>
                                                    <li class="review-item"><a href="#">Read Review</a></li>
                                                    <li class="review-item"><a href="#">Write Review</a></li>
                                                </ul>
                                            </div>
                                            <div class="price-box pt-20">
                                                <span class="new-price new-price-2">$57.98</span>
                                            </div>
                                            <div class="product-desc">
                                                <p>
                                                    <span>100% cotton double printed dress. Black and white striped top and orange high waisted skater skirt bottom. Lorem ipsum dolor sit amet, consectetur adipisicing elit. quibusdam corporis, earum facilis et nostrum dolorum accusamus similique eveniet quia pariatur.
                                                    </span>
                                                </p>
                                            </div>
                                            <div class="product-variants">
                                                <div class="produt-variants-size">
                                                    <label>Dimension</label>
                                                    <select class="nice-select">
                                                        <option value="1" title="S" selected="selected">40x60cm</option>
                                                        <option value="2" title="M">60x90cm</option>
                                                        <option value="3" title="L">80x120cm</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="single-add-to-cart">
                                                <form action="#" class="cart-quantity">
                                                    <div class="quantity">
                                                        <label>Quantity</label>
                                                        <div class="cart-plus-minus">
                                                            <input class="cart-plus-minus-box" value="1" type="text">
                                                            <div class="dec qtybutton"><i class="fa fa-angle-down"></i></div>
                                                            <div class="inc qtybutton"><i class="fa fa-angle-up"></i></div>
                                                        </div>
                                                    </div>
                                                    <button class="add-to-cart" type="submit">Add to cart</button>
                                                </form>
                                            </div>
                                            <div class="product-additional-info pt-25">
                                                <a class="wishlist-btn" href="/wishlist"><i class="fa fa-heart-o"></i>Add to wishlist</a>
                                                <div class="product-social-sharing pt-25">
                                                    <ul>
                                                        <li class="facebook"><a href="#"><i class="fa fa-facebook"></i>Facebook</a></li>
                                                        <li class="twitter"><a href="#"><i class="fa fa-twitter"></i>Twitter</a></li>
                                                        <li class="google-plus"><a href="#"><i class="fa fa-google-plus"></i>Google +</a></li>
                                                        <li class="instagram"><a href="#"><i class="fa fa-instagram"></i>Instagram</a></li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Quick View | Modal Area End Here -->
        </div></section>
        <script src="../js/header.js"></script>

        <!-- Body Wrapper End Here -->
        <!-- jQuery-V1.12.4 -->
        <script>
            const cartUpdate = async(id,_id) => {
              if (document.querySelector('.msg').getAttribute('data-msg').length > 0) {
                document.querySelector('.frame1').classList.remove("hide")
              document.querySelector('.loginModal').style.display = 'block'
              document.querySelector('.redirectHome').addEventListener('click',()=>{window.location.assign("/login-login")})
                //alert(document.querySelector('.msg').getAttribute('data-msg'));
                return;
              }else{
                document.querySelector('.frame2').classList.remove("hide")
                document.querySelector('.CartModal').style.display = 'block'
                document.querySelector('.addCart').addEventListener('click',()=>{window.location.reload()})
                // window.location.reload();
              }
              try {
                const res = await fetch('/cartUpdate', {
                    method: 'POST',
                    body: JSON.stringify({
                        id: id,
                        uid:_id
                    }),
                    headers: {
                        'Content-Type': 'application/json'
                    }
                })
                //window.location.reload()
              } catch (e) {
                console.log({ e });
              }

            }
            window.onload = async () => {
                const res = await fetch('/cartDetails', {
                    method: 'POST',
                    body: JSON.stringify({ _id: "<%= user===null ? null : user._id %>" }),
                    headers: {
                        'Content-Type': 'application/json'
                    }
                })

                const data = await res.json()
                const cartCount = data.cart.reduce((acc, val) => acc + val.count, 0)
                document.querySelectorAll('.cart-item-count')[1].textContent = cartCount ?? 0
                document.querySelector(".minicart-product-list").innerHTML = data.cart.reduce((acc, product) => {
                    acc += `
                        <li>
                            <a href="/single-product/${product.id}" class="minicart-product-image">
                                <img src="${product.image}" alt="cart products">
                            </a>
                            <div class="minicart-product-details">
                                <h6><a href="/single-product/${product.id}">${product.name}</a></h6>
                                <span>${product.discount} x ${product.count}</span>
                            </div>
                            <button class="close" title="Remove" data-id="${product.id}">
                                <i class="fa fa-close" data-id="${product.id}"></i>
                            </button>
                        </li>`
                    return acc
                }, '')

                const remove = document.querySelectorAll('button.close[data-id]')
                const update = async (e) => {
                    const productID = e.target.getAttribute('data-id');
                    try {
                        const response = await fetch('/remove', {
                            method: 'POST',
                            body: JSON.stringify({ id: productID, _id: "<%=user===null?null: user._id %>" }),
                            headers: {
                                'Content-Type': 'application/json'
                            }
                        })
                        const details = await response.json()
                        const res = await fetch('/cartDetails', {
                            method: 'POST',
                            body: JSON.stringify({ _id: "<%= user===null ?null: user._id %>" }),
                            headers: {
                                'Content-Type': 'application/json'
                            }
                        })

                        const data = await res.json()
                const cartCount = data.cart.reduce((acc, val) => acc + val.count, 0)
                        document.querySelectorAll('.cart-item-count')[1].textContent = cartCount ?? 0

                        document.querySelector(".minicart-product-list").innerHTML = data.cart.reduce((acc, product) => {
                            acc += `<li>
                                    <a href="/single-product/${product.id}" class="minicart-product-image">
                                        <img src="${product.image}" alt="cart products">
                                    </a>
                                    <div class="minicart-product-details">
                                        <h6><a href="/single-product/${product.id}">${product.name}</a></h6>
                                        <span>${product.discount} x ${product.count}</span>
                                    </div>
                                    <button class="close" data-id="${product.id}">
                                        <i class="fa fa-close" data-id="${product.id}"></i>
                                    </button>
                                </li>`
                            return acc
                        }, '')
                        window.location.reload()
                    } catch (e) {
                        alert("Can't remove item from cart")
                    }
                }
                remove.forEach(elmt => {
                    elmt.addEventListener('click', e => {
                      e.preventDefault();
                       update(e)
                    })
                })
            }
            const wishdetails=async()=>{
              const resp = await fetch('/wishlistdetails', {
                          method: 'POST',
                          body: JSON.stringify({ _id: "<%=user===null?null: user._id %>" }),
                  headers: {
                      'Content-Type': 'application/json'
                  }
              })
              const datas = await resp.json()
              const wishlistCount = datas.wishlist.length
              document.querySelectorAll('.wishlist-item-count')[0].textContent = wishlistCount ?? 0
            }

            const wish=async(id,uid)=>{
              if (document.querySelector('.msg').getAttribute('data-msg').length > 0) {
                document.querySelector('.frame1').classList.remove("hide")
              document.querySelector('.loginModal').style.display = 'block'
              document.querySelector('.redirectHome').addEventListener('click',()=>{window.location.assign("/login-login")})
                //alert(document.querySelector('.msg').getAttribute('data-msg'));
                return;
              }else{
                document.querySelector('.frame3').classList.remove("hide")
                document.querySelector('.WishlistModal').style.display = 'block'
                document.querySelector('.addWishlist').addEventListener('click',()=>{window.location.reload()})
                // window.location.reload();
              }
              //e.preventDefault();
              try {
                const resp = await fetch('/wishlistUpdate', {
                    method: 'POST',
                    body: JSON.stringify({
                        id,
                        uid
                    }),
                    headers: {
                        'Content-Type': 'application/json'
                    }
                })
                //window.location.reload()
              } catch (e) {
                console.log({ e });
              }
            }
            window.addEventListener('load',()=>{
                wishdetails()
            })


            document.querySelector('.signout').addEventListener('click',async ()=>{
                const res = await fetch('/signout', {method: 'POST',body:{}})
                window.location.reload()
            })

        </script>

<!-- single-product31:32-->
<%-include('partials/footer')%>
